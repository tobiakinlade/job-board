apiVersion: v1
kind: ConfigMap
metadata: 
  name: postgres-init-script
  namespace: job-board
data:
  init.sql: |
    CREATE TABLE IF NOT EXISTS jobs (
        id SERIAL PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        company VARCHAR(255) NOT NULL,
        location VARCHAR(255) NOT NULL,
        description TEXT NOT NULL,
        salary_range VARCHAR(100),
        job_type VARCHAR(50),
        posted_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    CREATE TABLE IF NOT EXISTS applications (
        id SERIAL PRIMARY KEY,
        job_id INTEGER REFERENCES jobs(id) ON DELETE CASCADE,
        applicant_name VARCHAR(255) NOT NULL,
        applicant_email VARCHAR(255) NOT NULL,
        resume_url VARCHAR(500),
        cover_letter TEXT,
        applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- Sample data
    INSERT INTO jobs (title, company, location, description, salary_range, job_type) 
    SELECT * FROM (VALUES
      ('Senior Software Engineer', 'Tech Corp', 'San Francisco, CA', 'We are looking for an experienced software engineer to join our team.', '$120k - $180k', 'Full-time'),
      ('Product Manager', 'Startup Inc', 'Remote', 'Help us build the next generation of products.', '$100k - $150k', 'Full-time'),
      ('Frontend Developer', 'Web Solutions', 'New York, NY', 'Create beautiful and responsive web applications.', '$80k - $120k', 'Full-time'),
      ('Data Scientist', 'AI Labs', 'Boston, MA', 'Work on cutting-edge machine learning projects.', '$110k - $160k', 'Full-time'),
      ('UX Designer', 'Design Studio', 'Austin, TX', 'Design intuitive user experiences for our products.', '$70k - $110k', 'Contract')
    ) AS v(title, company, location, description, salary_range, job_type)
    WHERE NOT EXISTS (SELECT 1 FROM jobs LIMIT 1);
